<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>game-engine v2</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="main.html" class="tocviewselflink" data-pltdoc="x">game-<wbr></wbr>engine v2</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="main.html#%28part._core%29" class="tocviewlink" data-pltdoc="x">core</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="main.html#%28part._components%29" class="tocviewlink" data-pltdoc="x">components</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="main.html#%28part._issues%29" class="tocviewlink" data-pltdoc="x">issues</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._game-engine_v2%29" class="tocsubseclink" data-pltdoc="x">game-<wbr></wbr>engine v2</a></td></tr><tr><td><span class="Smaller"><a href="main.html#%28elem._%28chunk._~3cmain~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;main&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._core%29" class="tocsubseclink" data-pltdoc="x">core</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._core_base%29" class="tocsubseclink" data-pltdoc="x">core/<span class="mywbr"> &nbsp;</span>base</a></td></tr><tr><td><span class="tocsublinknumber">1.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Basic_.Data_.Structures%29" class="tocsubseclink" data-pltdoc="x">Basic Data Structures</a></td></tr><tr><td><a href="#%28def._%28%28lib._game-engine%2Fengine%2Fcore%2Fmain..rkt%29._game%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="badlink"><span class="RktValLink">game</span></span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._game-engine%2Fengine%2Fcore%2Fmain..rkt%29._entity%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="badlink"><span class="RktValLink">entity</span></span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._game-engine%2Fengine%2Fcore%2Fmain..rkt%29._define-component%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="badlink"><span class="RktValLink">define-<wbr></wbr>component</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._crud%29" class="tocsubseclink" data-pltdoc="x">crud</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._intro%29" class="tocsubseclink" data-pltdoc="x">intro</a></td></tr><tr><td><span class="tocsublinknumber">1.4<tt>&nbsp;</tt></span><a href="#%28part._runtime%29" class="tocsubseclink" data-pltdoc="x">runtime</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._components%29" class="tocsubseclink" data-pltdoc="x">components</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Rendering%29" class="tocsubseclink" data-pltdoc="x">Rendering</a></td></tr><tr><td><a href="#%28def._%28%28lib._game-engine%2Fextensions%2Fmain..rkt%29._play%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">play!</span></a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._issues%29" class="tocsubseclink" data-pltdoc="x">issues</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Maintenance_.Tasks%29" class="tocsubseclink" data-pltdoc="x">Maintenance Tasks</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.Feature_.Ideas%29" class="tocsubseclink" data-pltdoc="x">Feature Ideas</a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Performance%29" class="tocsubseclink" data-pltdoc="x">Performance</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">7.0</span></div><h2><a name="(part._game-engine_v2)"></a>game-engine v2</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">thoughtstem</p></span></div><p>Gotta pick a better name</p><p>In part, we&rsquo;ll need to build some kind of side project to really be sure... And that will help keep things organized, plus provide a body of example code to help seed the community.   Start making an RPG example &ndash; heading toward the planes or one of the TS-Langs.
Let&rsquo;s document that, literate code style!
Rebuid this doc, start this section over.</p><p>This doc is (opinionatedly) backwards, starting with a motivating example.  The API docs are at the end.</p><p>Interesting provable properties:
* If the game ran without errors once, you can disable a component&rsquo;s behaviour without removing it, and the game should run without errors still.  Proof: The original game went through that state once.
* This allows any part of the system to be frozen, while other parts procede.  Nice for experimentation, debugging, etc.</p><p>Tutorial time!
Let&rsquo;s make an RPG game!</p><p>TODO: Move the latest hero and world definitions here.  Or move this there...
 Basically figure out what goes where.</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cmain~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="main.html#%28elem._%28chunk._~3cmain~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;main&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"../extensions/animation/main.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="hspace">&nbsp;</span><span class="RktVal">"../extensions/animation/test/util.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">play!</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">input-manager</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">blue-circle-avatar</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>;Umm, what are those requires buddy?</p><h3>1<tt>&nbsp;</tt><a name="(part._core)"></a>core</h3><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">thoughtstem</p></span></div><h4>1.1<tt>&nbsp;</tt><a name="(part._core_base)"></a><a name="(mod-path._game-engine/engine/core/main)"></a>core/base</h4><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">thoughtstem</p></span></div><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left" colspan="2"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="stt"> </span><a href="main.html#%28mod-path._game-engine%2Fengine%2Fcore%2Fmain%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">game-engine/engine/core/main</span></a><span class="RktPn">)</span></td></tr><tr><td align="left">&nbsp;</td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/game-engine" title="Install this package using `raco pkg install game-engine`"><span class="stt">game-engine</span></a></span></td></tr></table></p><h5>1.1.1<tt>&nbsp;</tt><a name="(part._.Basic_.Data_.Structures)"></a>Basic Data Structures</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._game-engine/engine/core/main..rkt)._game))"></a><span title="Provided from: game-engine/engine/core/main | Package: game-engine"><span class="RktSym"><span class="badlink"><span class="RktValLink">game</span></span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Constructor for a <span class="RktSym"><span class="badlink"><span class="RktValLink">game</span></span></span>.  Takes nothing but a list of entities.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._game-engine/engine/core/main..rkt)._entity))"></a><span title="Provided from: game-engine/engine/core/main | Package: game-engine"><span class="RktSym"><span class="badlink"><span class="RktValLink">entity</span></span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">component</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">component</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Constructor for a <span class="RktSym"><span class="badlink"><span class="RktValLink">entity</span></span></span>.  Takes nothing but a list of components.</div></p><p>Other than games and entities, the other basic building block is the component.  But these are things that you define and create yourself.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._game-engine/engine/core/main..rkt)._define-component))"></a><span title="Provided from: game-engine/engine/core/main | Package: game-engine"><span class="RktSym"><span class="badlink"><span class="RktValLink">define-component</span></span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktVar">contract</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Creates a new kind of component named <span class="RktVar">name</span>, whose values will always match the type described by the contract <span class="RktVar">contract</span>.
  Creating a component causes a bunch of useful functions to bedefined for you.</div></p><p>The most obvious one is the constructor, which we shall show in context below.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-component</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">number?</span></span></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">hero-health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">100</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">-</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">get-health</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;Now</span><span class="hspace">&nbsp;</span><span class="RktCmt">it</span><span class="hspace">&nbsp;</span><span class="RktCmt">can</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">attached</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">an</span><span class="hspace">&nbsp;</span><span class="RktCmt">entity,</span><span class="hspace">&nbsp;</span><span class="RktCmt">which</span><span class="hspace">&nbsp;</span><span class="RktCmt">can</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">added</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">game,</span><span class="hspace">&nbsp;</span><span class="RktCmt">and</span><span class="hspace">&nbsp;</span><span class="RktCmt">so</span><span class="hspace">&nbsp;</span><span class="RktCmt">on...</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">hero</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">hero-health</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>A component constructor (like <span class="RktSym">health</span>) above takes two arguments.  One is an initial value, the other is a description of how that value changes over time.</p><p>Above, the initial value of health is <span class="RktVal">100</span>; the description of change is <span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">-</span></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">get-health</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span>.  Together, these describe a health component whose value decreases with each tick.</p><p>It also introduces one of the other things you get for free with <span class="RktSym"><span class="badlink"><span class="RktValLink">define-component</span></span></span>, which is a getter: <span class="RktSym">get-health</span>.  This getter, when used without arguments, gets the current health value of the entity to which the component is attached.</p><p>Note that this getter can be used from other components, too.  For example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-component</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">number?</span></span></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define-component</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">death</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">any/c</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">hero-health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">100</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">-</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">get-health</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">hero-death</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">death</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">void</span></span></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">when</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">zero?</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">get-health</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">despawn</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">hero</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">hero-health</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">hero-death</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Here the <span class="RktSym">death</span> component uses <span class="RktPn">(</span><span class="RktSym">get-health</span><span class="RktPn">)</span> to check when the <span class="RktSym">health</span> component has reached 0.  These getters are the primary way of getting data to flow between components.  (What happens if there are two <span class="RktSym">health</span> components on the entity?  Don&rsquo;t do that; it&rsquo;s an error.  Components must have unique names.)</p><p>A quick note, there&rsquo;s one case where you don&rsquo;t have to use a getter, and can take advantage of a shorter syntax.  The <span class="RktSym">health</span> component could have been implemented as:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">100</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">lift</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Or, using the alias <span class="RktSym"><span class="badlink"><span class="RktValLink">^</span></span></span>, even shorter:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">100</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">^</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>These mean, apply the given function to the value stored in the component.
But be careful, it&rsquo;s not this simple:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">health</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">100</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>That is syntactically valid, but would mean that on every tick you want to replace the value in the component with the function reference <span class="RktSym"><span class="badlink"><span class="RktValLink">sub1</span></span></span>.  I&rsquo;m not sure why you&rsquo;d want to do that, but there are reasons you might want to store functions in components, so that ability is there.  Because that ability is there, you need to lift functions if you want to apply them, rather than store them.</p><p>Note: there are two special values that, if stored in a component, have a special meaning in the runtime.</p><p>One is <span class="RktSym"><span class="badlink"><span class="RktValLink">spawn</span></span></span>, which is a struct that stores an entity.  On any tick that this value appears in a component, the runtime will spawn that entiti.</p><p>The other is <span class="RktSym"><span class="badlink"><span class="RktValLink">despawn</span></span></span>, which is a struct with no fields.  On any tick that this value appears in a component, the runtime will destroy the entiti to which that component is attached.</p><p>Now that we&rsquo;ve defined games, entities, and components, we can talk about the runtime model.  Note that you have access to all functions that advance the state of games, entities, and components.</p><h4>1.2<tt>&nbsp;</tt><a name="(part._crud)"></a>crud</h4><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">thoughtstem</p></span></div><p>When you are writing your game logic, you will mostly be defining components (or using other people&rsquo;s components).  And you&rsquo;ll be defining functions that specify how components and/or entities change over time.  There&rsquo;s a basic CRUD (create, read, update, destroy) model for both components and entities.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">add-component</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span><span class="RktVar">component</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">component</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Create.</div></p><p>Adds the component to the beginning of the entity&rsquo;s list of components.
Returns a new entity where this is the case.  Does not change the original.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">get-component</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span><span class="RktVar">query?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">query?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Read.</div></p><p>Finds and returns the first component on the entity where <span class="RktSym">pred?</span> is true.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">update-component</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span><span class="RktVar">old</span><span class="hspace">&nbsp;</span><span class="RktVar">new</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">old</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">new</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Update.</div></p><p>Finds an existing component based on <span class="RktVar">old</span>.  If <span class="RktVar">old</span> is a component, then its id will be used to find a matching component on the entity.  If <span class="RktVar">old</span> is a predicate, it will find the first component for which that predicate is true.</p><p>Either way, it will be updated according to <span class="RktVar">new</span>.  If <span class="RktVar">new</span> is a component, that component will be swapped in (but <span class="RktVar">old</span>&rsquo;s id will remain).  If it is a function, that function will be called on <span class="RktVar">old</span> to get the new component.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">remove-component</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span><span class="RktVar">old</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">old</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Destroy.</div></p><p>Finds an existing component based on <span class="RktVar">old</span>.  If <span class="RktVar">old</span> is a component, then its id will be used to find a matching component on the entity.  If <span class="RktVar">old</span> is a predicate, it will find the first component for which that predicate is true.</p><p>The resulting entity no longer has <span class="RktVar">old</span> in its list.</p><p>With entities, the CRUD model is similar.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">add-entity</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span><span class="RktVar">new</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">new</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Create.</div></p><p>Adds the new entity to the beginning of the game&rsquo;s entity list.  Returns a new game where this is the case.  Does not modify the old game.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">get-entity</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span><span class="RktVar">query</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">query</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Read.</div></p><p>Finds the entity within the game.  The entity can be described either by a generic function or by an existing entity (in which case the id is used to find the match)</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">update-entity</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span><span class="RktVar">old</span><span class="hspace">&nbsp;</span><span class="RktVar">new</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">old</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">new</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Update.</div></p><p>Finds and updates an old entity. See <span class="RktSym">update-componet</span>; this function has the same flexibility of types when it comes to <span class="RktVar">old</span> and <span class="RktVar">new</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">remove-entity</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span><span class="RktVar">old</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">old</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or/c</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Destroy.</div></p><p>Finds and removes an entity described by <span class="RktVar">old</span>.</p><p>A useful function for constructing a function of the type <span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span> is <span class="RktSym"><span class="badlink"><span class="RktValLink">has-component</span></span></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">has-component</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">query</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">query</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Given the component query, returns an entity query that matches if the entity has a component matching the component query.</div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">update-entity</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">g</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">has-component</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">health?</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">update-entity-health-amount</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">add1</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><h4>1.3<tt>&nbsp;</tt><a name="(part._intro)"></a>intro</h4><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">thoughtstem</p></span></div><p>;game-engine v2 : Get to "release"
;  - Put online with new name, new repo
;  - Lindsey can use it for the planes
;  - Can use it for animations and side-projects
;  - Can publish about it
;  - Can start letting it replace game-engine throughout the ts languages
;  All of these are out of scope until it is released
;  Given that, I can probably put a timeline on the project completion.</p><p>;free up evenings for new side project (or double up on writing or work projects)</p><p>Multi-lingual game programming.  Many languages, all entity/component systems beautifully composed</p><p>Gives you a truly building-blocks approach to designing animations, simulations, and games.  Bottom up.  Easily create and share your own components, entities, games, partial games, game constructors, procedurally generated games, etc.  They&rsquo;re all just values and easily compose with one another.</p><p>Manipulating games programatically is quite easy.</p><p>That was relatively simple.  Three entities that start at 5 health and gain health at a rate of 1 per tick.
It&rsquo;s not even worth rendering &ndash; though perhaps it could be a nice building block for a simulation.</p><p>However, when you import other stuff...</p><h4>1.4<tt>&nbsp;</tt><a name="(part._runtime)"></a>runtime</h4><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">thoughtstem</p></span></div><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">tick</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">game</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">The returned game is the previous game, advanced one tick.</div></p><p>It does this by ticking every component on every entity in the order that they are listed.  During the tick, if any <span class="RktSym"><span class="badlink"><span class="RktValLink">spawn</span></span></span> or <span class="RktSym"><span class="badlink"><span class="RktValLink">despawn</span></span></span> values are produced by components, the runtime will take the appropriate actions AFTER all of the components have been ticked.</p><p>By default, the game is copied &ndash; not mutated.  To remove this guarantee, run within <span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">mutable!</span></span></span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">tick-entity</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">entity</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">entity</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">entity?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Ticks all of the components on an entity.  If any <span class="RktSym"><span class="badlink"><span class="RktValLink">spawn</span></span></span> or <span class="RktSym"><span class="badlink"><span class="RktValLink">despawn</span></span></span> values are produced, they have no effect.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">tick-component</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">component</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">component</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">component?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Updates the value stored in the component by replacing it with the value in the component&rsquo;s update expression.</div></p><p>If any <span class="RktSym"><span class="badlink"><span class="RktValLink">spawn</span></span></span> or <span class="RktSym"><span class="badlink"><span class="RktValLink">despawn</span></span></span> values are produced, they have no effect.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">ticks</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span><span class="RktVar">game</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">number?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Calls <span class="RktSym"><span class="badlink"><span class="RktValLink">tick</span></span></span> <span class="RktVar">n</span> times.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">tick-list</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span><span class="RktVar">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">listof</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">positive?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Returns a list of games beginning with the input game.  The list has length <span class="RktVar">n</span>.  Each subsequent game in the list is one <span class="RktSym"><span class="badlink"><span class="RktValLink">tick</span></span></span> away from each other.</div></p><p>Useful in debugging and analysis of games and simulations.  Also useful for getting all the frames of an animation for subsequent processing.</p><h3>2<tt>&nbsp;</tt><a name="(part._components)"></a><a name="(mod-path._game-engine/extensions/main)"></a>components</h3><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">thoughtstem</p></span></div><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left" colspan="2"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="stt"> </span><a href="main.html#%28mod-path._game-engine%2Fextensions%2Fmain%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">game-engine/extensions/main</span></a><span class="RktPn">)</span></td></tr></table></p><h4>2.1<tt>&nbsp;</tt><a name="(part._.Rendering)"></a>Rendering</h4><p>The rendering system takes a game and ticks it until the user terminates it.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._game-engine/extensions/main..rkt)._play!))"></a><span title="Provided from: game-engine/extensions/main"><span class="RktSym"><span class="RktSymDef RktSym">play!</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">game</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">game</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">game?</span></span></span></td></tr></table></blockquote></div><div class="SIntrapara">Pass in a game to rendering.</div></p><p>Any entities that have a <span class="RktSym">position</span> component and a <span class="RktSym">sprite</span>
component will be rendered.  See examples below.</p><p>These components are provided by ____.</p><p>TODO: Add layer, rotation, scale, and coloration support...</p><p>DOC THIS BEAUTIFUL THING:
level swapping when some objective is complete
  Manager
    -&gt; Level
    -&gt; Level
    -&gt; Level</p><p>DOC THIS
warping from one game to another via links,
  Is this different from a sequence (cycle) of levels?
  Yeah
  Manager
    -&gt; World
       -&gt; Next-World</p><p>Manager watches some component on the game,
    When that component produces a game, the manager swaps to that new game.
      (Back buffer, bread crumbs: Could capture the last game and provide a way to pop back to it.)</p><p>OMG, IF WE CAN GET TO THIS TODAY...
implement hotswap-dev
  Extension idea: one game throws error / other catches it and continues,</p><h3>3<tt>&nbsp;</tt><a name="(part._issues)"></a>issues</h3><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">thoughtstem</p></span></div><h4>3.1<tt>&nbsp;</tt><a name="(part._.Maintenance_.Tasks)"></a>Maintenance Tasks</h4><p>;TODO: Immutability is a lie.  See comment in test/define-component.rkt
;  Make a test that explicitly checks this property
;  By the way, is mutability helping us much?  Maybe we should take it out if it&rsquo;s not...</p><p>;TODO: Making render tests automated
;(Screenshots??)</p><h4>3.2<tt>&nbsp;</tt><a name="(part._.Feature_.Ideas)"></a>Feature Ideas</h4><p>Moonshot:
  Could we render game previews (various projections of the game?) embedded in a DrRacket snip?
  That sounds like a game changer...</p><p>;Can we use components that store (and tick) other components as a way to implement "systems"?
;Rendering two games at once.  A child game?
;Components within components.  Entities within components</p><p>;Keep having ideas about using rosette or constraint based programming to do
; * Procedural geneartion
; * Generating entire games, sequences
; * Flockin behavior</p><p>;Or other meta stuff:
; * A component containing a game and a behaviour that ticks it...
; * Run subgames within a game...
; * Procedurally create games at runtime, run them, do something with the result.
; * "Bake" a game, by running it and observing its values.  Faster now as a sub-game...</p><p>;For the paper we write about this engine:
; * Game-oriented programming?
; * A game-based programming "paradigmn"?</p><h4>3.3<tt>&nbsp;</tt><a name="(part._.Performance)"></a>Performance</h4><p>;ADD a section about performance. Raw notes below...
;TODO: Make conway fast again.  Query optimizations.  Caching.
;  I tried adding a lookup hash to entities, but I&rsquo;m not seeing any speed improvement on the red/green poopers...
;    Should remove if it&rsquo;s not helping
;TODO: Roll a profiler (or build on top of Racket&rsquo;s now that we&rsquo;ve simplified things again).
;  Done.
;  Testing it.  It seemed to blame Position for being slow, so I changed to an implementation of posn that it claims is faster.
;    But... it doesn&rsquo;t feel faster and the FPS looks the same.
;    (Then again, I need to disable the sampling to have a true test...)</p><p>;Have it print the stats over time</p><p>;One big problem is that I don&rsquo;t know what I should be expecting from this engine.  Is 20 FPS with 250 entities good or bad?
;  What would happen with unity?
;  What would happen with 2htdp/universe?</p><p>;Or another angle:
;  How many math operations per second should Racket be able to do?  How much overhead from garbage?  How much from memory allocations?
;  How many is this engine doing?
;  High level profiler might be able to give us that picture, btw.  So we can keep our estimations honest.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>